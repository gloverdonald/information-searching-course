<!doctype html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
 <head>
  <title>Портирование JS на Эльбрус / Хабр</title>
 </head>
 <body>
  <div id="app" data-server-rendered="true" data-async-called="true">
   <div class="tm-layout__wrapper">
    <!---->
    <div></div><!---->
    <header class="tm-header">
     <div class="tm-page-width">
      <div class="tm-header__container">
       <!----> <span class="tm-header__logo-wrap"> <span class="tm-header__beta-sign" style="display:none;">β</span></span>
       <div class="tm-dropdown tm-header__projects">
        <div class="tm-dropdown__head">
         <button class="tm-header__dropdown-toggle"></button>
        </div><!---->
       </div>
       <div class="tm-feature tm-header__feature tm-feature tm-feature_variant-inline">
        <!---->
       </div><!----> <!---->
      </div>
     </div>
    </header>
    <div class="tm-layout">
     <div class="tm-page-progress-bar"></div>
     <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky">
      <div class="tm-page-width">
       <div class="tm-base-layout__header-wrapper">
        <div class="tm-main-menu">
         <div class="tm-main-menu__section">
          <nav class="tm-main-menu__section-content">
          </nav>
         </div>
        </div>
        <div class="tm-header-user-menu tm-base-layout__user-menu">
         <!----> <!----> <!---->
         <div class="tm-header-user-menu__item">
          <button class="tm-header-user-menu__toggle"></button>
         </div> <!---->
         <div class="v-portal" style="display:none;"></div>
        </div>
       </div>
      </div>
     </div><!---->
     <div class="tm-page-width"></div>
     <main class="tm-layout__container">
      <div hl="ru" companyname="jugru" data-async-called="true" class="tm-page">
       <div class="tm-page-width">
        <div class="tm-page__header">
         <div class="tm-company-card__branding tm-company-article__branding tm-company-card__branding_loading">
          <div class="tm-company-card__branding-placeholder">
           <!---->
          </div>
         </div>
        </div>
        <div class="tm-page__wrapper">
         <div class="tm-page__main tm-page__main_has-sidebar">
          <div class="pull-down">
           <!---->
           <div class="pull-down__header" style="height:0px;">
            <div class="pull-down__content" style="bottom:10px;"></div>
           </div>
           <div class="tm-article-presenter">
            <!---->
            <div class="tm-company-profile-card tm-company-article__profile-card">
             <div class="tm-company-card tm-company-profile-card__info">
              <div class="tm-company-card__header">
               <!---->
               <div class="tm-counter-container tm-company-card__rating">
                <div class="tm-counter-container__header">
                 <div class="tm-votes-lever tm-votes-lever tm-votes-lever_appearance-rating">
                  <!---->
                  <div class="tm-votes-lever__score tm-votes-lever__score tm-votes-lever__score_appearance-rating">
                   <span><span class="tm-votes-lever__score-counter tm-votes-lever__score-counter tm-votes-lever__score-counter_rating"> 124.04 </span></span>
                  </div><!---->
                 </div>
                </div>
                <div class="tm-counter-container__footer">
                 <span class="tm-rating__text tm-rating__text"> Рейтинг </span>
                </div>
               </div><!---->
              </div>
              <div class="tm-company-card__info">
               <div class="tm-company-card__description">
                Конференции для Senior-разработчиков
               </div>
              </div>
             </div><!---->
            </div><!---->
            <div class="tm-article-presenter__body">
             <div class="tm-misprint-area">
              <div class="tm-misprint-area__wrapper">
               <article class="tm-article-presenter__content tm-article-presenter__content_narrow">
                <div class="tm-article-presenter__header">
                 <div class="tm-article-snippet tm-article-presenter__snippet tm-article-snippet">
                  <div class="tm-article-snippet__meta-container">
                   <div class="tm-article-snippet__meta">
                    <span class="tm-user-info tm-article-snippet__author"> <span class="tm-user-info__user tm-user-info__user_appearance-default"> <span class="tm-article-datetime-published"><time datetime="2018-09-19T09:29:16.000Z" title="2018-09-19, 12:29">19 сен 2018 в 12:29</time></span></span></span>
                   </div><!---->
                  </div>
                  <h1 lang="ru" class="tm-title tm-title_h1"><span>Портирование JS на Эльбрус</span></h1>
                  <div class="tm-article-snippet__stats">
                   <!---->
                   <div class="tm-article-reading-time">
                    <span class="tm-svg-icon__wrapper tm-article-reading-time__icon"></span> <span class="tm-article-reading-time__label"> 11 мин </span>
                   </div><span class="tm-icon-counter tm-data-icons__item"> <span class="tm-icon-counter__value">33K</span></span>
                  </div>
                  <div class="tm-publication-hubs__container">
                   <div class="tm-publication-hubs">
                    <span class="tm-publication-hub__link-container"></span><span class="tm-publication-hub__link-container"></span>
                   </div>
                  </div><!----> <!----> <!---->
                 </div>
                </div><!---->
                <div data-gallery-root="" lang="ru" class="tm-article-body">
                 <div></div>
                 <div id="post-content-body">
                  <div>
                   <div class="article-formatted-body article-formatted-body article-formatted-body_version-1">
                    <div xmlns="http://www.w3.org/1999/xhtml">
                     Это рассказ про портирование JavaScript на отечественную платформу Эльбрус, выполненное ребятами из компании UniPro. В статье — краткий сравнительный анализ платформ, детали процесса и подводные камни.
                     <br>
                     <br>
                     <br>
                     <br>
                      В основе статьи — доклад Дмитрия () Бежецкова и Владимира () Ануфриенко с HolyJS 2018 Piter. Под катом вы найдете видео и текстовую расшифровку доклада.
                     <br>
                     <br>
                     <div class="oembed">
                      <div>
                       <div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.2493%;">
                        <div class="tm-iframe_temp" data-src="https://www.youtube.com/embed/1zWUN6y2WbI?rel=0&amp;showinfo=1&amp;hl=en-US" data-style="border: 0; top: 0; left: 0; width: 100%; height: 100%; position: absolute;" id="" width=""></div>
                       </div>
                      </div>
                     </div>
                     <br>
                     <h2>Часть 1. Эльбрус, родом из России</h2>
                     <br>
                      Сначала разберемся с тем, что такое Эльбрус. Вот несколько ключевых особенностей данной платформы в сравнении с x86.
                     <br>
                     <br>
                     <h3>VLIW архитектура</h3>
                     <br>
                      Совершенно другое архитектурное решение, нежели суперскалярная архитектура, которая более распространена на рынке сейчас. VLIW позволяет более тонко выражать намерения в коде за счет явного управления всеми независимыми арифметико-логическими устройствами (АЛУ), которых у Эльбруса, к слову, 4. Это не исключает возможности простоя каких-то АЛУ, но все же увеличивает теоретическую производительность на один такт процессора.
                     <br>
                     <br>
                     <h3>Объединение команд в бандлы</h3>
                     <br>
                      Готовые процессорные команды объединяются в бандлы (Bundles). Один bundle — это одна большая инструкция, которая выполняется за условный такт. В ней есть много атомарных инструкций, которые в архитектуре Эльбрус исполняются независимо и сразу.
                     <br>
                     <br>
                     <br>
                     <br>
                      На изображении справа серыми прямоугольниками обозначены бандлы, получившиеся при обработке JS-кода слева. Если с инструкциями ldd, fmuld, faddd, fsqrts все примерно понятно, то с инструкция return в самом начале первого бандла вызывает удивление у людей, не знакомых с ассемблером Эльбруса. Эта инструкция загружает адрес возврата из текущей функции floatMath в регистр ctpr3 заранее, чтобы процессор смог успеть подкачать нужные инструкции. Затем в последнем бандле мы уже совершаем переход по заранее загруженному адресу в ctpr3.
                     <br>
                     <br>
                      Также стоит отметить что у Эльбруса намного больше регистров 192 + 32 + 32 против 16 + 16 +8 у x86.
                     <br>
                     <br>
                     <h3>Явная спекулятивность против неявной</h3>
                     <br>
                      Эльбрус поддерживает явную спекулятивность на уровне команд. Следовательно, мы можем сделать вызов и загрузку a.bar из памяти еще до проверки того, что она не является null, как это видно в коде справа. Если чтение логически в конце окажется невалидным, то значение в b просто будет помечено аппаратно как неправильное и обратиться к нему будет нельзя.
                     <br>
                     <br>
                     <br>
                     <br>
                     <h3>Поддержка условного исполнения</h3>
                     <br>
                      Эльбрус также поддерживает условное исполнение. Рассмотрим это на следующем примере.
                     <br>
                     <br>
                     <br>
                     <br>
                      Как мы видим, код из предыдущего примера про спекулятивность сокращается еще и за счет использования свертки условного выражение в зависимость не по управлению, а по данным. Эльбрус аппаратно поддерживает предикатные регистры, в которых можно хранить только два значение true или false. Основная их фишка в том, что можно помечать инструкции таким предикатом и зависимости от его значения в момент исполнения инструкция исполнится или нет. В данном примере инструкция cmpeq выполняет сравнение и его логический результат помещает в предикат P1, который затем используется как маркер для загрузки в результат значения из b. Соответственно если предикат был равен true, то и в result осталось значение 0.
                     <br>
                     <br>
                      Данный подход позволяет трансформировать довольно сложный граф управления программы в предикатное исполнение и соответственно повышает наполненность бандла. Теперь мы можем генерировать больше независимых команд под разными предикатами и наполнять ими бандлы. Эльбрус поддерживает 32 предикатных регистра, что позволяет кодировать 65 потоков управления (плюс один на отсутствие предиката на команде).
                     <br>
                     <br>
                     <h3>Три аппаратных стека по сравнению с одним в Intel</h3>
                     <br>
                      Два из них защищенные от модификации программистом. Один — chain-стек — отвечает за хранение адресов для возвратов из функций, другой — стек регистров — содержит параметры, через которые они передаются. В третьем — пользовательском стеке — хранятся переменные и данные пользователя. В intel все хранится в одном стеке, что порождает уязвимости, так как все адреса переходов, параметров находятся в одном незащищенном от модификаций пользователем месте. 
                     <br>
                     <br>
                     <h3>Нет динамического предсказателя переходов</h3>
                     <br>
                      Вместо него используется схема с if-конверсией и подготовками переходов, чтобы конвейер выполнения не останавливался.
                     <br>
                     <br>
                     <h3>Так зачем нам JS на Эльбрусе?</h3>
                     <br>
                     <ol>
                     </ol>
                     <br>
                     <h3>Если нет интерпретатора, приходят два компилятора</h3>
                     <br>
                      За основу была взята предыдущая реализация v8 от Гугл. Работает она так: из исходного кода создается абстрактное синтаксическое дерево, далее в зависимости от того, исполнялся ли код или нет, с помощью одного из двух компиляторов (Crankshaft или FullCodegen) создается, соответственно, оптимизированный или неоптимизированный бинарный код. При этом интерпретатора нет.
                     <br>
                     <br>
                     <br>
                     <br>
                     <h3>Как работает FullCodegen?</h3>
                     <br>
                      Узлы синтаксического дерева переводятся в бинарный код, после чего все «склеивается» вместе. Один узел представляет собой около 300 строк кода на макроассемблере. Это, во-первых, дает широкий горизонт оптимизаций, а, во-вторых, отсутствуют переходы по байткодам, как в интерпретаторе. Это просто, но в то же время существует проблема — во время портирования придется переписать много кода на макроассемблере.
                     <br>
                     <br>
                     <br>
                     <br>
                      Тем не менее, все это было сделано, и получилась версия компилятора FullCodegen 1.0 для Эльбрус. Делалось все через C++ runtime v8, ничего не оптимизировали, ассемблерный код был просто переписан с x86 под архитектуру Эльбрус.
                     <br>
                     <br>
                     <h3>Codegen 1.1</h3>
                     <br>
                      В итоге результат получился не совсем таким, как ожидали, и было решено выпустить версию FullCodegen 1.1:
                     <br>
                     <br>
                     <ul>
                     </ul>
                     <br>
                     <br>
                     <br>
                      Обратите внимание, что проверка на NaN, undefined, null делается за один раз, без использования if, которое бы потребовалось в Intel-архитектуре.
                     <br>
                     <br>
                     <ul>
                     </ul>
                     <br>
                      Тесты проводились в Google Octane. Тестовые машины:
                     <br>
                     <br>
                     <ul>
                     </ul>
                     <br>
                      Далее результаты:
                     <br>
                     <br>
                     <br>
                     <br>
                      На гистограмме — соотношение результатов, т.е. во сколько раз Эльбрус хуже «Интела». На двух тестах Crypto и zlib результаты заметно хуже из-за того, что в Эльбрусе еще нет аппаратных инструкций для работы с шифрованием. В целом, учитывая разницу в частотах, получилось неплохо.
                     <br>
                     <br>
                      Далее тест в сравнении с интерпретатором js из firefox, входящего в стандартную поставку Эльбруса. &nbsp;Больше — лучше.
                     <br>
                     <br>
                     <br>
                      Вердикт — компилятор снова справился неплохо.
                     <br>
                     <br>
                     <h3>Результаты разработки</h3>
                     <br>
                     <ul>
                     </ul>
                     <br>
                     <h3>Казалось, ничего не предвещало</h3>
                     <br>
                      Все было бы хорошо, но тут Google объявил, что больше не поддерживает FullCodegen и Crankshaft и они будут удалены. После чего команда получила заказ на разработку для браузера Firefox, и об этом — дальше.
                     <br>
                     <br>
                     <br>
                     <br>
                     <h2>Часть 2. Firefox и ее обезьяна-паук</h2>
                     <br>
                      Речь пойдет о движке браузера Firefox — SpiderMonkey. На рисунке отличия между этим движком и более новым V8.
                     <br>
                     <br>
                     <br>
                     <br>
                      Видно, что на первом этапе все похоже, исходный код парсится в абстрактное синтаксическое дерево, потом в байт-код, а далее начинаются отличия. 
                     <br>
                     <br>
                      В SpiderMonkey байт-код интерпретируется C++ интерпретатором, который в сущности напоминает большой switch, внутри которого совершаются прыжки по байт-коду. Далее интерпретированный код попадает в неотимизирующий компилятор Baseline. Затем на финальной стадии в дело включается оптимизирующий компилятор Ion. В движке V8 байт-код обрабатывается интерпретатором Ingnition, а затем компилятором TurboFan.
                     <br>
                     <br>
                     <h3>Baseline, выбираю тебя!</h3>
                     <br>
                      Портирование начали с компилятора Baseline. Он в сущности представляет собой стековую машину. То есть есть некий стек, из ячеек которого он берет переменные, запоминает их, производит с ними какие-то действия, после чего возвращает как переменные, так и результаты действий обратно в ячейки стека. Ниже на нескольких картинках пошагово отображен этот механизм в отношении простой функции foo:
                     <br>
                     <br>
                     <br>
                     <br>
                     <br>
                     <br>
                     <br>
                     <br>
                     <br>
                     <br>
                     <h3>Что такое framе?</h3>
                     <br>
                     <br>
                     <br>
                      На изображениях выше вы можете видеть слово frame. Грубо говоря, это Javascript-контекст на железе, то есть набор данных в стеке, описывающий какую-либо вашу функцию. На изображении ниже функция foo, а справа от нее то, как она выглядит в стеке: аргументы, описание функции, адрес возврата, указание на предыдущий фрейм, ведь функция откуда-то была вызвана и чтобы корректно вернуться в место вызова эта информация должна хранится в стеке, а далее уже сами локальные переменные функции и операнды для вычислений.
                     <br>
                     <br>
                     <br>
                     <br>
                      Таким образом, <b>достоинства Baseline</b>:
                     <br>
                     <br>
                     <ul>
                     </ul>
                     <br>
                      Но есть и <b>минусы</b>:
                     <br>
                     <br>
                     <ul>
                     </ul>
                     <br>
                      Оставалось только реализовать макроассемблер и получить готовый компилятор. Отладка тоже не предвещала особых проблем, достаточно было посмотреть стек на архитектуре x86, а потом на тот, что получался при портировании, чтобы найти проблему.
                     <br>
                     <br>
                      В итоге по тестам с новым компилятором производительность выросла в три раза:
                     <br>
                     <br>
                     <br>
                     <br>
                      Тем не менее, Octane не поддерживает работу с исключениями. А их реализация очень важна.
                     <br>
                     <br>
                     <h3>Исключительная работа</h3>
                     <br>
                      Для начала разберемся, как работают исключения на x86. Пока выполняется программа, в стек записываются адреса возврата из функций. В какой-то момент происходит исключение. Переходим в runtime обработчик исключений, в котором используются фреймы, о которых мы говорили выше. Находим, где конкретно возникло исключение, после чего нам нужно отмотать стек до нужного состояния, а далее меняется адрес возврата на тот, где будет обработано исключение. 
                     <br>
                     <br>
                      Проблема в том, что из-за другого устройства стека на архитектуре Эльбрус так сделать не получится. Потребуется по системным вызовам подсчитать, сколько нужно отмотать назад в Chain-стеке. Далее делаем системный вызов, чтобы получить стек вызовов. Далее в адресе в Chain-стеке делаем замену на адрес, делающий возврат.
                     <br>
                     <br>
                      Ниже иллюстрация об очередности данных шагов.
                     <br>
                     <br>
                     <br>
                     <br>
                      Не самый быстрый способ, тем не менее, исключение обрабатывается. Но все-таки на Intel это выглядит как-то попроще:
                     <br>
                     <br>
                     <br>
                     <br>
                      С Эльбрусом прыжков до самого обработчика будет больше:
                     <br>
                     <br>
                     <br>
                      Вот почему не стоит основывать логику программы на исключениях, тем более на Эльбрусе.
                     <br>
                     <br>
                     <h3>Оптимизируй это!</h3>
                     <br>
                      Итак, обработка исключений реализована. Теперь расскажем, как мы сделали все это чуть более быстрым: 
                     <br>
                     <br>
                     <ul>
                     </ul>
                     <br>
                     <ul>
                     </ul>
                     <br>
                      На втором пункте остановимся чуть более подробно. Мы уже рассматривали небольшой пример работы с bundles, к нему и перейдем. 
                     <br>
                     <br>
                     <br>
                     <br>
                      Любая операция, например, загрузки не делается в один такт, в данном случае она делается в три такта. Таким образом, если мы хотим перемножить два числа, пришли в операцию умножения, но сами операнды еще не загрузились, процессору остается только ждать их загрузки. И он будет ждать некоторое количество тактов, кратное четырем. Но если вручную выставить задержки, время ожидания можно сократить, тем самым повысив быстродействие. Далее процесс расстановки задержек был автоматизирован.
                     <br>
                     <br>
                     <br>
                     <br>
                      Итоги оптимизации BaseLine v1.0 vs Baseline v1.1. Несомненно, движок стал быстрее.
                     <br>
                     <br>
                     <br>
                     <br>
                     <h3>Как же это программистам и не сделать Ion’ную пушку?</h3>
                     <br>
                      На волне успеха от реализации Baseline v1.1 было решено портировать и оптимизирующий компилятор Ion.
                     <br>
                     <br>
                     <br>
                     <br>
                      Как работает оптимизирующий компилятор? Исходный код интерпретируется, запускается компиляция. В процессе выполнения байт-кода Ion собирает данные о типах, использующихся в программе, происходит анализ «горячих функций» — тех, которые выполняются чаще других. После этого принимается решение скомпилировать их получше, оптимизировать. Далее строится высокоуровневое представление компилятора, граф операций. На графе происходит оптимизация (opt 1, opt 2, opt …), создается низкоуровневое представление, состоящее из машинных команд, резервируются регистры, генерируется непосредственно оптимизированный бинарный код.
                     <br>
                     <br>
                     <br>
                     <br>
                      На Эльбрусе регистров больше и сами команды большие, поэтому нужны:
                     <br>
                     <br>
                     <ul>
                     </ul>
                     <br>
                      У команды уже имелся опыт портирования Java на Эльбрус, эту же библиотеку для генерации кода решили использовать и для портирования Ion. Она называется TANGO. В ней есть: 
                     <br>
                     <br>
                     <ul>
                     </ul>
                     <br>
                      Осталось привнести высокоуровневое представление в TANGO, сделать селектор. Проблема в том, что низкоуровневое представление в TANGO похоже на ассемблер, который сложен в поддержке и отладке. Как должен выглядеть компилятор внутри? В Mozilla для большей понятности сделали свой компилятор HolyJit, также есть еще вариант написать свой мини-язык для перевода между высокоуровневым и низкоуровневым представлением. 
                     <br>
                     <br>
                     <br>
                     <br>
                      Разработка еще ведется. Ну а далее о том, как не перестараться с оптимизацией.
                     <br>
                     <br>
                     <h2>Часть 3. Лучшее — враг хорошего</h2>
                     <br>
                     <h3>Компиляция, как она есть</h3>
                     <br>
                      Процесс оптимизации в Ion, когда код нагревается, а потом компилируется и оптимизируется — жадный, это можно увидеть на следующем примере. 
                     <br>
                     <br>
                     <pre><code class="javascript">function foo(a, b) {
 &nbsp;return a + b;
}

function doSomeStuff(obj) {
 &nbsp;for (let i = 0; i &lt; 1100; ++i) {
 &nbsp;&nbsp;&nbsp;print(foo(obj,obj));
 &nbsp;}
}

doSomeStuff("HollyJS");
doSomeStuff({n:10});
</code></pre>
                     <br>
                      При запуске в JS Shell с отключенной многопоточностью (для чистоты эксперимента), &nbsp;&nbsp;который поставляется с Mozilla, видим следующую ситуацию:
                     <br>
                     <br>
                     <br>
                     <br>
                      Функция исполняется. Мы видим, что счетчик количества исполнений большой, но в какой-то момент появляется сообщение о bailout (катапультировании). Это означает, что произошла деоптимизация. В данном случае в функцию foo сначала передаются объекты типа object, но после прогона функции в цикле со строками в качестве аргументов, компилятор решает так оптимизировать код, как будто данная функция работает только со строками. Если декомпилировать оптимизированный код, получится следующее:
                     <br>
                     <br>
                     <pre><code class="javascript">function doSomeStuff(obj) {
 &nbsp;for (let i=0; i &lt; 1100; ++i) {
 &nbsp;&nbsp;&nbsp;if (!(obj instanceof String))
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// bailout
 &nbsp;&nbsp;&nbsp;print(foo_only_str(obj, obj));
 &nbsp;}
}
</code></pre>
                     <br>
                      Как только в функцию будет передан первый аргумент не строка, оптимизированный код будет выброшен и мы снова перейдем на неоптимизированную версию кода.
                     <br>
                     <br>
                      На изображении мы видим пример низкоуровневой работы компилятора. Серым отмечены команды, которые были им оптимизированы при создании новой версии кода, например при DCE.
                     <br>
                     <br>
                     <br>
                     <br>
                     <h2>Пониженная передача</h2>
                     <br>
                      При катапультировании мы переходим в менее оптимизированный код, который ожидает, что на стеке будут все нужные ему объекты, как будто все это время исполнялась именно неоптимизированная версия кода.
                     <br>
                     <br>
                      Для того чтобы данные, необходимые для выполнения, при этом не терялись, в SpiderMonkey есть Resume Point. Что-то вроде точек сохранения, к которым всегда можно вернуться. В них сохраняются все операнды, нужные на данный момент для восстановления baseline фреймов. Но их недостаточно, поэтому в runtime нужно получить информацию, где находятся эти операнды. Проходит фаза lowering, regAlloc, после чего получается снимок (snapshot), в котором известно, где находятся нужные операнды. На основе этой информации восстанавливается baseline фрейм.
                     <br>
                     <br>
                      Процедура изображена на картинке:
                     <br>
                     <br>
                     <br>
                     <br>
                      В runtime на x86 это выглядит следующим образом: допустим, проверка в оптимизированном коде сработала и вас катапультировало. Собирается дамп регистров и нужная из них информация. Вызывается С, в куче размещается информация о полученных фреймах, вызывается еще один стаб, копирующий операнды на стек, а затем делается переход на байткод, который соответствует точке сохранения. Или, если вы были посреди инлайн кэша, переключается на Type монитор. Схема изображена ниже:
                     <br>
                     <br>
                     <br>
                     <br>
                      На Эльбрусе так не получится, потому что одна функция соответствует нескольким фреймам, а фреймы в Эльбрусе управляются железом и хранятся в защищенном chain стеке. Следовательно, нужно воссоздать не один фрейм, а несколько. 
                     <br>
                     <br>
                      Схема для Эльбруса более сложная: есть промежуточный деоптимизационный стаб, который воссоздает всю эту информацию на chain-стеке, рекурсивно вызывая себя N раз, затем происходит системный вызов, который подменяет адреса возвратов на соответствующие адреса фреймов baseline, и затем переходит на точку сохранения и возобновляет выполнение. &nbsp;
                     <br>
                     <br>
                      Это стоит учесть при разработке, если у вас в коде часто встречается деоптимизация.
                     <br>
                     <br>
                      Переработанная схема для архитектуры Эльбрус:
                     <br>
                     <br>
                     <br>
                      Результатом всей работы портирования Ion стал 4-х кратный прирост производительности на некоторых бенчмарках по сравнению с предыдущей реализацией baseline. Гистограмму вы можете увидеть ниже:
                     <br>
                     <br>
                     <br>
                     <br>
                     <h2>Итоги</h2>
                     <br>
                      Итак, теперь вы знаете, что на Эльбрусе есть SpiderMonkey, V8 и Node. В целом портирование — несложный процесс. Его можно выполнять небольшой командой. 
                     <br>
                     <br>
                      Но всегда важно помнить про подводные камни. В случае с Эльбрусом ими были деоптимизация, медленная работа стабов, работа с задержками конвейера и chain-стек.
                     <br>
                     <br>
                     <blockquote>
                      Если доклад понравился, обратите внимание: 24-25 ноября в Москве состоится новая , и там тоже будет много интересного. Уже известная информация о программе — на сайте, и билеты можно приобрести там же.
                     </blockquote>
                    </div>
                   </div>
                  </div><!----> <!---->
                 </div><!----> <!---->
                </div><!---->
                <div class="tm-article-presenter__meta">
                 <div class="tm-article-presenter__meta-list tm-separated-list">
                  <span class="tm-separated-list__title">Теги:</span>
                  <ul class="tm-separated-list__list">
                   <!---->
                  </ul>
                 </div>
                 <div class="tm-article-presenter__meta-list tm-separated-list">
                  <span class="tm-separated-list__title">Хабы:</span>
                  <ul class="tm-separated-list__list">
                   <!---->
                  </ul>
                 </div>
                </div><!---->
               </article>
              </div><!---->
             </div>
             <div class="tm-article-sticky-panel">
              <div class="tm-data-icons tm-article-sticky-panel__icons">
               <div class="tm-article-rating tm-data-icons__item">
                <div title="Всего голосов 128: ↑125 и ↓3" class="tm-votes-lever tm-article-rating__votes-switcher tm-votes-lever tm-votes-lever_appearance-article">
                 <button title="Нравится" type="button" class="tm-votes-lever__button"></button>
                 <div class="tm-votes-lever__score tm-votes-lever__score tm-votes-lever__score_appearance-article">
                  <span><span class="tm-votes-lever__score-counter tm-votes-lever__score-counter tm-votes-lever__score-counter_positive"> +122 </span></span>
                 </div><button title="Не нравится" type="button" class="tm-votes-lever__button"></button>
                </div>
                <div class="v-portal" style="display:none;"></div><!---->
               </div><!----> <!----> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span class="tm-svg-icon__wrapper bookmarks-button__icon"></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter"> 81 </span></button>
               <div title="Поделиться" class="tm-sharing tm-data-icons__item">
                <button type="button" class="tm-sharing__button"></button>
                <div class="v-portal" style="display:none;"></div>
               </div>
               <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item">
                <!---->
               </div><!---->
               <div class="v-portal" style="display:none;"></div>
              </div>
             </div>
            </div>
            <div class="tm-article-presenter__footer">
             <div class="tm-article-blocks">
              <!---->
              <section class="tm-block tm-block tm-block_spacing-bottom">
               <!---->
               <div class="tm-block__body tm-block__body tm-block__body_variant-balanced">
                <div class="tm-article-author">
                 <div class="tm-article-author__company">
                  <div class="tm-article-author__company-card">
                   <div class="tm-company-snippet">
                    <div class="tm-company-snippet__info">
                     <div class="tm-company-snippet__description">
                      Конференции для Senior-разработчиков
                     </div>
                    </div>
                   </div>
                   <div class="tm-article-author__buttons">
                    <!----> <!---->
                   </div>
                  </div>
                  <div class="tm-article-author__company-contacts"></div>
                  <div class="tm-article-author__separator"></div>
                 </div>
                 <div class="tm-user-card tm-article-author__user-card tm-user-card tm-user-card_variant-article">
                  <div class="tm-user-card__info-container">
                   <div class="tm-user-card__header">
                    <div class="tm-user-card__header-data">
                     <div class="tm-user-card__meta">
                      <div title=" 1147 голосов " class="tm-counter-container tm-karma tm-karma">
                       <div class="tm-counter-container__header">
                        <div class="tm-karma__votes tm-karma__votes_positive">
                         383
                        </div>
                       </div>
                       <div class="tm-counter-container__footer">
                        <div class="tm-karma__text">
                         Карма
                        </div>
                        <div class="v-portal" style="display:none;"></div>
                       </div>
                      </div>
                      <div title="Рейтинг пользователя" class="tm-counter-container">
                       <div class="tm-counter-container__header">
                        <div class="tm-votes-lever tm-votes-lever tm-votes-lever_appearance-rating">
                         <!---->
                         <div class="tm-votes-lever__score tm-votes-lever__score tm-votes-lever__score_appearance-rating">
                          <span><span class="tm-votes-lever__score-counter tm-votes-lever__score-counter tm-votes-lever__score-counter_rating"> 17 </span></span>
                         </div><!---->
                        </div>
                       </div>
                       <div class="tm-counter-container__footer">
                        <span class="tm-rating__text tm-rating__text"> Рейтинг </span>
                       </div>
                      </div>
                     </div>
                    </div>
                   </div>
                   <div class="tm-user-card__info tm-user-card__info tm-user-card__info_variant-article">
                    <div class="tm-user-card__title tm-user-card__title tm-user-card__title_variant-article">
                     <span class="tm-user-card__name tm-user-card__name tm-user-card__name_variant-article">Евгений Трифонов</span> <!---->
                    </div>
                    <p class="tm-user-card__short-info tm-user-card__short-info tm-user-card__short-info_variant-article">ContentProvider</p>
                   </div>
                  </div>
                  <div class="tm-user-card__buttons tm-user-card__buttons tm-user-card__buttons_variant-article">
                   <!----> <!----> <!----> <!---->
                  </div>
                 </div><!---->
                </div>
               </div><!---->
              </section><!----> <!---->
              <div class="tm-article-blocks__comments">
               <div id="publication-comments" class="tm-article-page-comments">
                <div class="tm-article-comments-counter-link tm-article-comments-counter-button">
                 <!---->
                </div>
               </div>
              </div>
              <section class="tm-block tm-block tm-block_spacing-bottom">
               <header class="tm-block__header tm-block__header tm-block__header_variant-borderless">
                <div class="tm-block__header-container">
                 <h2 class="tm-block__title tm-block__title tm-block__title_variant-large">Публикации</h2>
                </div><!---->
               </header>
               <div class="tm-block__body tm-block__body tm-block__body_variant-condensed-slim">
                <div class="tm-tabs tm-tabs">
                 <div>
                  <span class="tm-tabs__tab-item"><button class="tm-tabs__tab-link tm-tabs__tab-link tm-tabs__tab-link_active tm-tabs__tab-link_slim"> Лучшие за сутки </button></span><span class="tm-tabs__tab-item"><button class="tm-tabs__tab-link tm-tabs__tab-link tm-tabs__tab-link_slim"> Похожие </button></span>
                 </div><!---->
                </div>
                <div class="similar-and-daily__tab-view">
                 <div class="placeholder-wrapper">
                  <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!---->
                  <div class="tm-placeholder-article-cards">
                   <div class="tm-placeholder-article-card">
                    <div class="tm-placeholder__user">
                     <div class="tm-placeholder__user-pic loads"></div>
                     <div class="tm-placeholder__user-date loads"></div>
                    </div>
                    <div class="tm-placeholder-article-card__title">
                     <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div>
                     <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div>
                    </div>
                    <div class="tm-placeholder-article-card__icons tm-placeholder__counters">
                     <div class="tm-placeholder-data-icon">
                      <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                      <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                     </div>
                     <div class="tm-placeholder-data-icon">
                      <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                      <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                     </div>
                     <div class="tm-placeholder-data-icon">
                      <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                      <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                     </div>
                     <div class="tm-placeholder-data-icon">
                      <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                      <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                     </div>
                    </div>
                   </div>
                   <div class="tm-placeholder-article-card">
                    <div class="tm-placeholder__user">
                     <div class="tm-placeholder__user-pic loads"></div>
                     <div class="tm-placeholder__user-date loads"></div>
                    </div>
                    <div class="tm-placeholder-article-card__title">
                     <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div>
                     <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div>
                    </div>
                    <div class="tm-placeholder-article-card__icons tm-placeholder__counters">
                     <div class="tm-placeholder-data-icon">
                      <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                      <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                     </div>
                     <div class="tm-placeholder-data-icon">
                      <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                      <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                     </div>
                     <div class="tm-placeholder-data-icon">
                      <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                      <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                     </div>
                     <div class="tm-placeholder-data-icon">
                      <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                      <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                     </div>
                    </div>
                   </div>
                   <div class="tm-placeholder-article-card">
                    <div class="tm-placeholder__user">
                     <div class="tm-placeholder__user-pic loads"></div>
                     <div class="tm-placeholder__user-date loads"></div>
                    </div>
                    <div class="tm-placeholder-article-card__title">
                     <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div>
                     <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div>
                    </div>
                    <div class="tm-placeholder-article-card__icons tm-placeholder__counters">
                     <div class="tm-placeholder-data-icon">
                      <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                      <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                     </div>
                     <div class="tm-placeholder-data-icon">
                      <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                      <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                     </div>
                     <div class="tm-placeholder-data-icon">
                      <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                      <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                     </div>
                     <div class="tm-placeholder-data-icon">
                      <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                      <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                     </div>
                    </div>
                   </div>
                   <div class="tm-placeholder-article-card">
                    <div class="tm-placeholder__user">
                     <div class="tm-placeholder__user-pic loads"></div>
                     <div class="tm-placeholder__user-date loads"></div>
                    </div>
                    <div class="tm-placeholder-article-card__title">
                     <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div>
                     <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div>
                    </div>
                    <div class="tm-placeholder-article-card__icons tm-placeholder__counters">
                     <div class="tm-placeholder-data-icon">
                      <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                      <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                     </div>
                     <div class="tm-placeholder-data-icon">
                      <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                      <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                     </div>
                     <div class="tm-placeholder-data-icon">
                      <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                      <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                     </div>
                     <div class="tm-placeholder-data-icon">
                      <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                      <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                     </div>
                    </div>
                   </div>
                   <div class="tm-placeholder-article-card">
                    <div class="tm-placeholder__user">
                     <div class="tm-placeholder__user-pic loads"></div>
                     <div class="tm-placeholder__user-date loads"></div>
                    </div>
                    <div class="tm-placeholder-article-card__title">
                     <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div>
                     <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div>
                    </div>
                    <div class="tm-placeholder-article-card__icons tm-placeholder__counters">
                     <div class="tm-placeholder-data-icon">
                      <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                      <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                     </div>
                     <div class="tm-placeholder-data-icon">
                      <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                      <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                     </div>
                     <div class="tm-placeholder-data-icon">
                      <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                      <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                     </div>
                     <div class="tm-placeholder-data-icon">
                      <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                      <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                     </div>
                    </div>
                   </div>
                  </div><!----> <!----> <!----> <!----> <!---->
                 </div><!---->
                </div>
               </div><!---->
              </section>
              <div class="placeholder-wrapper">
               <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!---->
               <div class="tm-placeholder-inset tm-placeholder-vacancies">
                <div class="tm-placeholder-inset__header">
                 <div class="tm-placeholder__line tm-placeholder__line_inset-header loads"></div>
                </div>
                <div class="tm-placeholder-inset__body">
                 <ul class="tm-placeholder-list"></ul>
                </div>
                <div class="tm-placeholder-inset__footer">
                 <div class="tm-placeholder__line tm-placeholder__line_inset-footer loads"></div>
                </div>
               </div><!----> <!----> <!----> <!----> <!----> <!----> <!----> <!---->
              </div><!---->
             </div>
            </div>
           </div>
          </div>
         </div>
         <div class="tm-page__sidebar">
          <div class="tm-layout-sidebar">
           <div class="tm-layout-sidebar__placeholder_initial"></div>
           <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;">
            <!---->
            <section class="tm-block tm-block tm-block_spacing-bottom">
             <header class="tm-block__header tm-block__header">
              <div class="tm-block__header-container">
               <h2 class="tm-block__title tm-block__title">Информация</h2>
              </div><!---->
             </header>
             <div class="tm-block__body tm-block__body">
              <div class="tm-company-basic-info">
               <dl class="tm-description-list tm-description-list tm-description-list_variant-columns-nowrap">
                <dt class="tm-description-list__title tm-description-list__title tm-description-list__title_variant-columns-nowrap">
                 Сайт
                </dt>
                <dd class="tm-description-list__body tm-description-list__body tm-description-list__body_variant-columns-nowrap"></dd>
               </dl>
               <dl class="tm-description-list tm-description-list tm-description-list_variant-columns-nowrap">
                <dt class="tm-description-list__title tm-description-list__title tm-description-list__title_variant-columns-nowrap">
                 Дата регистрации
                </dt>
                <dd class="tm-description-list__body tm-description-list__body tm-description-list__body_variant-columns-nowrap">
                 <time datetime="2013-08-22T14:33:51.000Z" title="2013-08-22, 18:33">22 августа 2013</time>
                </dd>
               </dl>
               <dl class="tm-description-list tm-description-list tm-description-list_variant-columns-nowrap">
                <dt class="tm-description-list__title tm-description-list__title tm-description-list__title_variant-columns-nowrap">
                 Дата основания
                </dt>
                <dd class="tm-description-list__body tm-description-list__body tm-description-list__body_variant-columns-nowrap">
                 <time datetime="2012-02-24T20:00:00.000Z" title="2012-02-25, 00:00">25 февраля 2012</time>
                </dd>
               </dl>
               <dl class="tm-description-list tm-description-list tm-description-list_variant-columns-nowrap">
                <dt class="tm-description-list__title tm-description-list__title tm-description-list__title_variant-columns-nowrap">
                 Численность
                </dt>
                <dd class="tm-description-list__body tm-description-list__body tm-description-list__body_variant-columns-nowrap">
                 51–100 человек
                </dd>
               </dl>
               <dl class="tm-description-list tm-description-list tm-description-list_variant-columns-nowrap">
                <dt class="tm-description-list__title tm-description-list__title tm-description-list__title_variant-columns-nowrap">
                 Местоположение
                </dt>
                <dd class="tm-description-list__body tm-description-list__body tm-description-list__body_variant-columns-nowrap">
                 Россия
                </dd>
               </dl>
               <dl class="tm-description-list tm-description-list tm-description-list_variant-columns-nowrap">
                <dt class="tm-description-list__title tm-description-list__title tm-description-list__title_variant-columns-nowrap">
                 Представитель
                </dt>
                <dd class="tm-description-list__body tm-description-list__body tm-description-list__body_variant-columns-nowrap"></dd>
               </dl>
              </div>
             </div><!---->
            </section>
            <div class="tm-company-widgets"></div><!----> <!----> <!---->
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </main><!---->
    </div>
    <div class="tm-footer-menu">
     <div class="tm-page-width">
      <div class="tm-footer-menu__container">
       <div class="tm-footer-menu__block">
        <p class="tm-footer-menu__block-title">Ваш аккаунт</p>
        <div class="tm-footer-menu__block-content">
         <ul class="tm-footer-menu__list"></ul>
        </div>
       </div>
       <div class="tm-footer-menu__block">
        <p class="tm-footer-menu__block-title">Разделы</p>
        <div class="tm-footer-menu__block-content">
         <ul class="tm-footer-menu__list"></ul>
        </div>
       </div>
       <div class="tm-footer-menu__block">
        <p class="tm-footer-menu__block-title">Информация</p>
        <div class="tm-footer-menu__block-content">
         <ul class="tm-footer-menu__list"></ul>
        </div>
       </div>
       <div class="tm-footer-menu__block">
        <p class="tm-footer-menu__block-title">Услуги</p>
        <div class="tm-footer-menu__block-content">
         <ul class="tm-footer-menu__list"></ul>
        </div>
       </div>
      </div>
     </div>
    </div>
    <div class="tm-footer">
     <div class="tm-page-width">
      <div class="tm-footer__container">
       <!---->
       <div class="tm-footer__social"></div>
       <div class="v-portal" style="display:none;"></div><button class="tm-footer__link"><!----> Настройка языка </button>
       <div class="tm-footer-copyright">
        <span class="tm-copyright"><span class="tm-copyright__years">© 2006–2024, </span> <span class="tm-copyright__name"></span></span>
       </div>
      </div>
     </div>
    </div><!---->
   </div>
   <div class="vue-portal-target"></div>
  </div>
  <noscript>
   <div>
   </div>
  </noscript>
 </body>
</html>